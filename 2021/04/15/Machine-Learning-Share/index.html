<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">

<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="">
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin="">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="baidu-site-verification" content="code-gluZbaulkl">






  
  
  <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script>

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","version":"8.3.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.">
<meta property="og:type" content="article">
<meta property="og:title" content="Machine Learning Share">
<meta property="og:url" content="http://example.com/2021/04/15/Machine-Learning-Share/index.html">
<meta property="og:site_name" content="Henfy-Blog">
<meta property="og:description" content="Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-04-15T15:31:49.000Z">
<meta property="article:modified_time" content="2021-04-16T04:14:43.326Z">
<meta property="article:author" content="henfy">
<meta property="article:tag" content="share">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2021/04/15/Machine-Learning-Share/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script><link rel="dns-prefetch" href="https://waline.vercel.app">
<title>Machine Learning Share | Henfy-Blog</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CPT+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext');loadCss('https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css');loadCss('https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css');loadCss('https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CPT+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Henfy-Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Quick-Start"><span class="nav-number">1.</span> <span class="nav-text">Quick Start</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Importing"><span class="nav-number">1.1.</span> <span class="nav-text">Importing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#File-exist"><span class="nav-number">1.2.</span> <span class="nav-text">File exist</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Set-parameter"><span class="nav-number">1.3.</span> <span class="nav-text">Set parameter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Data-Gan"><span class="nav-number">1.4.</span> <span class="nav-text">Data Gan</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Plot-data"><span class="nav-number">1.5.</span> <span class="nav-text">Plot data</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Class-weight"><span class="nav-number">1.6.</span> <span class="nav-text">Class weight</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Callback"><span class="nav-number">1.7.</span> <span class="nav-text">Callback</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Model"><span class="nav-number">1.8.</span> <span class="nav-text">Model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fit-model"><span class="nav-number">1.9.</span> <span class="nav-text">Fit model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Plot-curves"><span class="nav-number">1.10.</span> <span class="nav-text">Plot curves</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Evaluate-model"><span class="nav-number">1.11.</span> <span class="nav-text">Evaluate model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Plot-confusion-matrix"><span class="nav-number">1.12.</span> <span class="nav-text">Plot confusion matrix</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="henfy" src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">henfy</p>
  <div class="site-description" itemprop="description">一个技术分享的博客</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/henfy233" title="GitHub → https://github.com/henfy233" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:619899573@qq.com" title="E-Mail → mailto:619899573@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/yourname" title="Weibo → https://weibo.com/yourname" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://github.com/henfy233" title="https://github.com/henfy233" rel="noopener" target="_blank">Github</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://example.com/" title="http://example.com/">Weibo</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://example.com/" title="http://example.com/">WeChat</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/15/Machine-Learning-Share/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="henfy">
      <meta itemprop="description" content="一个技术分享的博客">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Henfy-Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Machine Learning Share
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-15 23:31:49" itemprop="dateCreated datePublished" datetime="2021-04-15T23:31:49+08:00">2021-04-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-16 12:14:43" itemprop="dateModified" datetime="2021-04-16T12:14:43+08:00">2021-04-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
    </span>

  
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>10k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 ≈</span>
      <span>9 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<span id="more"></span>

<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Importing"><a href="#Importing" class="headerlink" title="Importing"></a>Importing</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib <span class="keyword">as</span> mpl</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> sklearn</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(tf.__version__)</span><br><span class="line"><span class="built_in">print</span>(sys.version_info)</span><br><span class="line"><span class="keyword">for</span> module <span class="keyword">in</span> mpl, np, pd, sklearn, tf, keras:</span><br><span class="line">    <span class="built_in">print</span>(module.__name__, module.__version__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># import PIL</span></span><br><span class="line"><span class="comment"># import IPython</span></span><br><span class="line"><span class="comment"># import kerastuner as kt</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="File-exist"><a href="#File-exist" class="headerlink" title="File exist"></a>File exist</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">train_dir = <span class="string">"G:/dataset/rgbdsm/rgdsm/256_256/three grades-newGan/train"</span></span><br><span class="line">test_dir = <span class="string">"G:/dataset/rgbdsm/rgdsm/256_256/three grades-Gan/val"</span></span><br><span class="line">val_dir = <span class="string">"G:/dataset/rgbdsm/rgdsm/256_256/three grades-newGan/test"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(os.path.exists(train_dir))</span><br><span class="line"><span class="built_in">print</span>(os.path.exists(test_dir))</span><br><span class="line"><span class="built_in">print</span>(os.path.exists(val_dir))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(os.listdir(train_dir))</span><br><span class="line"><span class="built_in">print</span>(os.listdir(test_dir))</span><br><span class="line"><span class="built_in">print</span>(os.listdir(val_dir))</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Set-parameter"><a href="#Set-parameter" class="headerlink" title="Set parameter"></a>Set parameter</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">width = <span class="number">256</span></span><br><span class="line">height = <span class="number">256</span></span><br><span class="line">channels = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">epochs = <span class="number">40</span></span><br><span class="line">num_classes = <span class="number">3</span></span><br><span class="line">batch_size = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">save_path = <span class="string">'./save_weights/3_{epoch:02d}-{val_accuracy:.2f}.h5'</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="Data-Gan"><a href="#Data-Gan" class="headerlink" title="Data Gan"></a>Data Gan</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">train_datagen = keras.preprocessing.image.ImageDataGenerator(</span><br><span class="line"><span class="comment">#     rescale=1./255,</span></span><br><span class="line"><span class="comment">#     preprocessing_function=keras.applications.efficientnet.preprocess_input,</span></span><br><span class="line">    preprocessing_function=keras.applications.densenet.preprocess_input,</span><br><span class="line"><span class="comment">#     rotation_range=3,</span></span><br><span class="line"><span class="comment">#      width_shift_range=0.02,</span></span><br><span class="line"><span class="comment">#      height_shift_range=0.02,</span></span><br><span class="line"><span class="comment">#     zoom_range=0.1,</span></span><br><span class="line"><span class="comment">#     horizontal_flip=True,</span></span><br><span class="line"><span class="comment">#     vertical_flip=True,</span></span><br><span class="line"><span class="comment">#     brightness_range = (0.95, 1.05),</span></span><br><span class="line"><span class="comment">#     fill_mode='nearest',</span></span><br><span class="line"><span class="comment">#     validation_split=0.2</span></span><br><span class="line">)</span><br><span class="line">train_generator = train_datagen.flow_from_directory(train_dir,</span><br><span class="line">                                                    target_size=(height, width),</span><br><span class="line">                                                    batch_size= batch_size,</span><br><span class="line">                                                    seed=<span class="number">7</span>,</span><br><span class="line">                                                    shuffle=<span class="literal">True</span>,</span><br><span class="line">                                                    color_mode=<span class="string">"rgb"</span>,</span><br><span class="line"><span class="comment">#                                                     subset="training",</span></span><br><span class="line">                                                    class_mode=<span class="string">"categorical"</span>)</span><br><span class="line">val_datagen = keras.preprocessing.image.ImageDataGenerator(</span><br><span class="line"><span class="comment">#     rescale=1./255,</span></span><br><span class="line">    preprocessing_function=keras.applications.densenet.preprocess_input,</span><br><span class="line">)</span><br><span class="line">val_generator = val_datagen.flow_from_directory(val_dir,</span><br><span class="line">                                                  **target_size**=(height, width),</span><br><span class="line">                                                  batch_size=batch_size,</span><br><span class="line">                                                  seed=<span class="number">7</span>,</span><br><span class="line">                                                  shuffle=<span class="literal">False</span>,</span><br><span class="line">                                                  color_mode=<span class="string">"rgb"</span>,</span><br><span class="line"><span class="comment">#                                                   subset="validation",</span></span><br><span class="line">                                                  class_mode=<span class="string">"categorical"</span>)</span><br><span class="line">test_datagen = keras.preprocessing.image.ImageDataGenerator(</span><br><span class="line"><span class="comment">#     rescale=1./255,</span></span><br><span class="line">    preprocessing_function=keras.applications.densenet.preprocess_input,</span><br><span class="line">)</span><br><span class="line">test_generator = test_datagen.flow_from_directory(test_dir,</span><br><span class="line">                                                  target_size=(height, width),</span><br><span class="line">                                                  batch_size=batch_size,</span><br><span class="line">                                                  seed=<span class="number">7</span>,</span><br><span class="line">                                                  shuffle=<span class="literal">False</span>,</span><br><span class="line">                                                  color_mode=<span class="string">"rgb"</span>,</span><br><span class="line"><span class="comment">#                                                   subset="validation",</span></span><br><span class="line">                                                  class_mode=<span class="string">"categorical"</span>)</span><br><span class="line">train_num = train_generator.samples</span><br><span class="line">val_num = val_generator.samples</span><br><span class="line">test_num = test_generator.samples</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(train_num, val_num)</span><br><span class="line"><span class="built_in">print</span>(train_generator.class_indices)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    x, y = train_generator.<span class="built_in">next</span>()</span><br><span class="line">    <span class="built_in">print</span>(x.shape, y.shape)</span><br><span class="line"><span class="comment">#     print(y)</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="Plot-data"><a href="#Plot-data" class="headerlink" title="Plot data"></a>Plot data</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class_names = [<span class="string">'0-30'</span>, <span class="string">'31-60'</span>, <span class="string">'61-100'</span>]</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>,<span class="number">8</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    plt.subplot(<span class="number">4</span>,<span class="number">4</span>,i+<span class="number">1</span>)</span><br><span class="line">    plt.xticks([])</span><br><span class="line">    plt.yticks([])</span><br><span class="line">    plt.grid(<span class="literal">False</span>)</span><br><span class="line">    plt.imshow(train_generator[i][<span class="number">0</span>][x]/<span class="number">255</span>, cmap=plt.cm.binary)</span><br><span class="line">    plt.xlabel(class_names[np.argmax(train_generator[i][<span class="number">1</span>][x])])</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Class-weight"><a href="#Class-weight" class="headerlink" title="Class weight"></a>Class weight</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">filenames = tf.io.gfile.glob(<span class="built_in">str</span>(train_dir + <span class="string">'/*/*'</span>))</span><br><span class="line"></span><br><span class="line">COUNT_1 = <span class="built_in">len</span>([filename <span class="keyword">for</span> filename <span class="keyword">in</span> filenames <span class="keyword">if</span> <span class="string">"0-30"</span> <span class="keyword">in</span> filename])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"0-30 images count in training set: "</span> + <span class="built_in">str</span>(COUNT_1))</span><br><span class="line"></span><br><span class="line">COUNT_2 = <span class="built_in">len</span>([filename <span class="keyword">for</span> filename <span class="keyword">in</span> filenames <span class="keyword">if</span> <span class="string">"31-60"</span> <span class="keyword">in</span> filename])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"31-60 images count in training set: "</span> + <span class="built_in">str</span>(COUNT_2))</span><br><span class="line"></span><br><span class="line">COUNT_3 = <span class="built_in">len</span>([filename <span class="keyword">for</span> filename <span class="keyword">in</span> filenames <span class="keyword">if</span> <span class="string">"61-100"</span> <span class="keyword">in</span> filename])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"61-100 images count in training set: "</span> + <span class="built_in">str</span>(COUNT_3))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 平衡数据集</span></span><br><span class="line">weight_for_0 = (<span class="number">1</span> / COUNT_1)*(train_num)/<span class="number">3.0</span></span><br><span class="line">weight_for_1 = (<span class="number">1</span> / COUNT_2)*(train_num)/<span class="number">3.0</span></span><br><span class="line">weight_for_2 = (<span class="number">1</span> / COUNT_3)*(train_num)/<span class="number">3.0</span></span><br><span class="line"></span><br><span class="line">class_weight = {<span class="number">0</span>: weight_for_0, <span class="number">1</span>: weight_for_1, <span class="number">2</span>: weight_for_2}</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Weight for class 0: {:.2f}'</span>.<span class="built_in">format</span>(weight_for_0))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Weight for class 1: {:.2f}'</span>.<span class="built_in">format</span>(weight_for_1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Weight for class 2: {:.2f}'</span>.<span class="built_in">format</span>(weight_for_2))</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Callback"><a href="#Callback" class="headerlink" title="Callback"></a>Callback</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.callbacks <span class="keyword">import</span> ReduceLROnPlateau</span><br><span class="line"><span class="keyword">from</span> keras.callbacks <span class="keyword">import</span> ModelCheckpoint, LearningRateScheduler</span><br><span class="line"><span class="keyword">from</span> keras.callbacks <span class="keyword">import</span> TensorBoard</span><br><span class="line"></span><br><span class="line">lr_callback = ReduceLROnPlateau(monitor=<span class="string">'val_loss'</span>,</span><br><span class="line">                                patience=<span class="number">3</span>,</span><br><span class="line">                                verbose=<span class="number">1</span>,</span><br><span class="line">                                factor=<span class="number">0.2</span>,</span><br><span class="line">                                min_lr=<span class="number">0.000001</span>)</span><br><span class="line"><span class="comment"># 设置模型保存路径，且根据val_acc保存最优模型</span></span><br><span class="line">checkpoint = ModelCheckpoint(filepath=save_path,</span><br><span class="line">                                monitor=<span class="string">'val_accuracy'</span>,</span><br><span class="line">                                save_weights_only=<span class="literal">False</span>,</span><br><span class="line">                                save_best_only=<span class="literal">True</span>,</span><br><span class="line">                                mode=<span class="string">'auto'</span>,</span><br><span class="line">                                period=<span class="number">1</span>)</span><br><span class="line">tbCallBack = TensorBoard(log_dir=<span class="string">'g:/logs'</span>)</span><br><span class="line">callbacks = [lr_callback</span><br><span class="line">             checkpoint,</span><br><span class="line"><span class="comment">#              tbCallBack</span></span><br><span class="line">            ]</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># def create_model(hp):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_model</span>():</span></span><br><span class="line"></span><br><span class="line">    pretrained_model = tf.keras.applications.DenseNet201(weights=<span class="string">'imagenet'</span>,</span><br><span class="line">                                                            input_shape=[width, height, channels],</span><br><span class="line">                                                            include_top=<span class="literal">False</span>)</span><br><span class="line">    pretrained_model.trainable = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     hp_units = hp.Int('units', min_value = 32, max_value = 512, step = 32)</span></span><br><span class="line">    model = tf.keras.Sequential([</span><br><span class="line"><span class="comment">#         tf.keras.layers.InputLayer(input_shape=[width, height, channels]),</span></span><br><span class="line">        pretrained_model,</span><br><span class="line"><span class="comment">#         tf.keras.layers.Conv2D(filters=32, kernel_size=3, padding='same',</span></span><br><span class="line"><span class="comment">#                               activation='relu'),</span></span><br><span class="line"><span class="comment">#         tf.keras.layers.Conv2D(filters=32, kernel_size=3, padding='same',</span></span><br><span class="line"><span class="comment">#                               activation='relu'),</span></span><br><span class="line"><span class="comment">#         tf.keras.layers.MaxPool2D(pool_size=2),</span></span><br><span class="line"><span class="comment">#         tf.keras.layers.Conv2D(filters=64, kernel_size=3, padding='same',</span></span><br><span class="line"><span class="comment">#                               activation='relu'),</span></span><br><span class="line"><span class="comment">#         tf.keras.layers.Conv2D(filters=64, kernel_size=3, padding='same',</span></span><br><span class="line"><span class="comment">#                               activation='relu'),</span></span><br><span class="line"><span class="comment">#         tf.keras.layers.MaxPool2D(pool_size=2),</span></span><br><span class="line"><span class="comment">#         tf.keras.layers.Conv2D(filters=128, kernel_size=3, padding='same',</span></span><br><span class="line"><span class="comment">#                               activation='relu'),</span></span><br><span class="line"><span class="comment">#         tf.keras.layers.Conv2D(filters=128, kernel_size=3, padding='same',</span></span><br><span class="line"><span class="comment">#                               activation='relu'),</span></span><br><span class="line"><span class="comment">#         tf.keras.layers.MaxPool2D(pool_size=2),</span></span><br><span class="line"><span class="comment">#         tf.keras.layers.BatchNormalization(),</span></span><br><span class="line"><span class="comment">#         tf.keras.layers.Dropout(0.5),</span></span><br><span class="line">        tf.keras.layers.GlobalAveragePooling2D(),</span><br><span class="line">        tf.keras.layers.Dense(units = <span class="number">32</span>, activation = <span class="string">'relu'</span>),</span><br><span class="line"><span class="comment">#         tf.keras.layers.Dense(units = 256, activation = 'relu'),</span></span><br><span class="line">        tf.keras.layers.Dropout(<span class="number">0.2</span>),</span><br><span class="line">        tf.keras.layers.Dense(num_classes, activation=<span class="string">'softmax'</span>,</span><br><span class="line"><span class="comment">#                               kernel_regularizer='l2'</span></span><br><span class="line">                             )</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line"><span class="comment">#     hp_learning_rate = hp.Choice('learning_rate', values = [1e-2, 1e-3, 1e-4])</span></span><br><span class="line">    model.<span class="built_in">compile</span>(</span><br><span class="line">        optimizer = tf.keras.optimizers.Adam(learning_rate=<span class="number">0.0001</span>),</span><br><span class="line"><span class="comment">#         optimizer=tf.keras.optimizers.Adam(lr=lr_schedule(0)),</span></span><br><span class="line"><span class="comment">#         optimizer='sgd',</span></span><br><span class="line"><span class="comment">#         optimizer='adam',</span></span><br><span class="line">        loss=<span class="string">'categorical_crossentropy'</span>,</span><br><span class="line">        metrics=[<span class="string">'accuracy'</span>]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Fit-model"><a href="#Fit-model" class="headerlink" title="Fit model"></a>Fit model</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">model = create_model()</span><br><span class="line">model.summary()</span><br><span class="line">history1 = model.fit(train_generator,</span><br><span class="line">                     steps_per_epoch=train_num // batch_size,</span><br><span class="line">                     validation_data=val_generator,</span><br><span class="line">                     validation_steps=val_num // batch_size,</span><br><span class="line">                     epochs=epochs,</span><br><span class="line">                     verbose=<span class="number">1</span>,</span><br><span class="line"><span class="comment">#                      class_weight=class_weight,</span></span><br><span class="line">                     callbacks=callbacks</span><br><span class="line">                    )</span><br><span class="line"><span class="comment"># 终端 tensorboard --logdir=g:/logs</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="Plot-curves"><a href="#Plot-curves" class="headerlink" title="Plot curves"></a>Plot curves</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">display_training_curves</span>(<span class="params">training, validation, title, subplot</span>):</span></span><br><span class="line">    <span class="keyword">if</span> subplot % <span class="number">10</span> == <span class="number">1</span>:  <span class="comment"># set up the subplots on the first call</span></span><br><span class="line">        plt.subplots(figsize=(<span class="number">10</span>, <span class="number">10</span>), facecolor=<span class="string">'#F0F0F0'</span>)</span><br><span class="line">        plt.tight_layout()</span><br><span class="line">    ax = plt.subplot(subplot)</span><br><span class="line">    ax.set_facecolor(<span class="string">'#F8F8F8'</span>)</span><br><span class="line">    ax.plot(training)</span><br><span class="line">    ax.plot(validation)</span><br><span class="line">    ax.set_title(<span class="string">'model '</span> + title)</span><br><span class="line">    ax.set_ylabel(title)</span><br><span class="line">    <span class="comment"># ax.set_ylim(0.28,1.05)</span></span><br><span class="line">    ax.set_xlabel(<span class="string">'epoch'</span>)</span><br><span class="line">    ax.legend([<span class="string">'train'</span>, <span class="string">'valid.'</span>])</span><br><span class="line"></span><br><span class="line">final_accuracy = history1.history[<span class="string">"val_accuracy"</span>][-<span class="number">5</span>:]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"FINAL ACCURACY MEAN-5: "</span>, np.mean(final_accuracy))</span><br><span class="line">display_training_curves(history1.history[<span class="string">'accuracy'</span>][<span class="number">1</span>:], history1.history[<span class="string">'val_accuracy'</span>][<span class="number">1</span>:], <span class="string">'accuracy'</span>, <span class="number">211</span>)</span><br><span class="line">display_training_curves(history1.history[<span class="string">'loss'</span>][<span class="number">1</span>:], history1.history[<span class="string">'val_loss'</span>][<span class="number">1</span>:], <span class="string">'loss'</span>, <span class="number">212</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Evaluate-model"><a href="#Evaluate-model" class="headerlink" title="Evaluate model"></a>Evaluate model</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file_path = './save_weights/3_17-0.84.h5'</span></span><br><span class="line"><span class="comment"># model.load_weights(file_path)</span></span><br><span class="line"></span><br><span class="line">val_loss, val_acc = model.evaluate(test_generator)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'\nTest accuracy:'</span>, val_acc)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'\nTest loss:'</span>, val_loss)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Plot-confusion-matrix"><a href="#Plot-confusion-matrix" class="headerlink" title="Plot confusion matrix"></a>Plot confusion matrix</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> confusion_matrix</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_confusion_matrix</span>(<span class="params">cm, target_names,title=<span class="string">'Confusion matrix'</span>,cmap=<span class="literal">None</span>,normalize=<span class="literal">False</span></span>):</span></span><br><span class="line">    accuracy = np.trace(cm) / <span class="built_in">float</span>(np.<span class="built_in">sum</span>(cm)) <span class="comment">#计算准确率</span></span><br><span class="line">    misclass = <span class="number">1</span> - accuracy <span class="comment">#计算错误率</span></span><br><span class="line">    <span class="keyword">if</span> cmap <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        cmap = plt.get_cmap(<span class="string">'Blues'</span>) <span class="comment">#颜色设置成蓝色</span></span><br><span class="line">    plt.figure(figsize=(<span class="number">6</span>, <span class="number">4</span>)) <span class="comment">#设置窗口尺寸</span></span><br><span class="line">    plt.imshow(cm, interpolation=<span class="string">'nearest'</span>, cmap=cmap) <span class="comment">#显示图片</span></span><br><span class="line">    plt.title(title) <span class="comment">#显示标题</span></span><br><span class="line">    plt.colorbar() <span class="comment">#绘制颜色条</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> target_names <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        tick_marks = np.arange(<span class="built_in">len</span>(target_names))</span><br><span class="line">        plt.xticks(tick_marks, target_names, rotation=<span class="number">45</span>) <span class="comment">#x坐标标签旋转45度</span></span><br><span class="line">        plt.yticks(tick_marks, target_names) <span class="comment">#y坐标</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> normalize:</span><br><span class="line">        cm = cm.astype(<span class="string">'float32'</span>) / cm.<span class="built_in">sum</span>(axis=<span class="number">1</span>)</span><br><span class="line">        cm = np.<span class="built_in">round</span>(cm,<span class="number">2</span>) <span class="comment">#对数字保留两位小数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    thresh = cm.<span class="built_in">max</span>() / <span class="number">1.5</span> <span class="keyword">if</span> normalize <span class="keyword">else</span> cm.<span class="built_in">max</span>() / <span class="number">2</span></span><br><span class="line">    <span class="keyword">for</span> i, j <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(cm.shape[<span class="number">0</span>]), <span class="built_in">range</span>(cm.shape[<span class="number">1</span>])): <span class="comment">#将cm.shape[0]、cm.shape[1]中的元素组成元组，遍历元组中每一个数字</span></span><br><span class="line">        <span class="keyword">if</span> normalize: <span class="comment">#标准化</span></span><br><span class="line">            plt.text(j, i, <span class="string">"{:0.2f}"</span>.<span class="built_in">format</span>(cm[i, j]), <span class="comment">#保留两位小数</span></span><br><span class="line">                     horizontalalignment=<span class="string">"center"</span>,  <span class="comment">#数字在方框中间</span></span><br><span class="line">                     color=<span class="string">"white"</span> <span class="keyword">if</span> cm[i, j] &gt; thresh <span class="keyword">else</span> <span class="string">"black"</span>)  <span class="comment">#设置字体颜色</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment">#非标准化</span></span><br><span class="line">            plt.text(j, i, <span class="string">"{:,}"</span>.<span class="built_in">format</span>(cm[i, j]),</span><br><span class="line">                     horizontalalignment=<span class="string">"center"</span>,  <span class="comment">#数字在方框中间</span></span><br><span class="line">                     color=<span class="string">"white"</span> <span class="keyword">if</span> cm[i, j] &gt; thresh <span class="keyword">else</span> <span class="string">"black"</span>) <span class="comment">#设置字体颜色</span></span><br><span class="line"></span><br><span class="line">    plt.tight_layout() <span class="comment">#自动调整子图参数,使之填充整个图像区域</span></span><br><span class="line">    plt.ylabel(<span class="string">'True label'</span>) <span class="comment">#y方向上的标签</span></span><br><span class="line">    plt.xlabel(<span class="string">"Predicted label\naccuracy={:0.4f}\n misclass={:0.4f}"</span>.<span class="built_in">format</span>(accuracy, misclass)) <span class="comment">#x方向上的标签</span></span><br><span class="line">    plt.show() <span class="comment">#显示图片</span></span><br><span class="line"></span><br><span class="line">labels = [<span class="string">'0-30'</span>, <span class="string">'31-60'</span>, <span class="string">'60-100'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预测验证集数据整体准确率</span></span><br><span class="line">Y_pred = model.predict(test_generator, test_num // batch_size + <span class="number">1</span>)</span><br><span class="line"><span class="comment"># 将预测的结果转化为one hit向量</span></span><br><span class="line">Y_pred_classes = np.argmax(Y_pred, axis = <span class="number">1</span>)</span><br><span class="line"><span class="comment"># 计算混淆矩阵</span></span><br><span class="line">confusion_mtx = confusion_matrix(y_true = test_generator.classes,y_pred = Y_pred_classes)</span><br><span class="line"><span class="comment"># 绘制混淆矩阵</span></span><br><span class="line">plot_confusion_matrix(confusion_mtx, normalize=<span class="literal">True</span>, target_names=labels)</span><br></pre></td></tr></tbody></table></figure>

<p>model style: resnet v2</p>
<p>3_22-0.86.h5</p>
<p>test acc: 0.7713004350662231</p>
<p>3_34-0.87.h5</p>
<p>Test acc: 0.7623318433761597</p>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/share/" rel="tag"><i class="fa fa-tag"></i> share</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/04/13/plan/" rel="prev" title="plan">
                  <i class="fa fa-chevron-left"></i> plan
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  © 2017 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">henfy</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">11k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">10 分钟</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://theme-next.js.org/mist/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>


  






  

  




  




<script src="/bundle.js"></script><script>
    NProgress.configure({
      showSpinner: true
    });
    NProgress.start();
    document.addEventListener('readystatechange', () => {
      if (document.readyState === 'interactive') {
        NProgress.inc(0.8);
      }
      if (document.readyState === 'complete') {
        NProgress.done();
      }
    });
    document.addEventListener('pjax:send', () => {
      NProgress.start();
    });
    document.addEventListener('pjax:success', () => {
      NProgress.done();
    });
  ;

NexT.utils.loadComments('#waline-comments', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/@waline/client@0.14.8/dist/Waline.min.js', () => {
    new Waline(Object.assign({
      lang: 'zh-CN'
    }, {"enable":true,"serverURL":"https://waline.vercel.app","placeholder":"Just go go","avatar":"monsterid","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":["nick","mail"],"lang":"zh-cn","libUrl":"https://cdn.jsdelivr.net/npm/@waline/client@0.14.8/dist/Waline.min.js"}, {
      el: '#waline-comments',
      path: "/2021/04/15/Machine-Learning-Share/",
    }));
  }, window.Waline);
});
</script></body></html>